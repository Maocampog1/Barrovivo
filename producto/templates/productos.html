{% load humanize %}

<div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
  {% for p in productos %}
    <div class="col">
      <div class="card card-producto h-100 position-relative">
        <!-- Botón de favoritos -->
        <div class="favorito-btn position-absolute" style="top: 10px; right: 10px; z-index: 10;">
          {% if user.is_authenticated %}
            <form method="post" action="{% url 'producto:toggle_favorito' p.id %}" class="d-inline">
              {% csrf_token %}
              <input type="hidden" name="next" value="{{ request.path }}">
              <button type="submit" class="btn-favorito {% if p.es_favorito %}favorito-activo{% endif %}" 
                      title="{% if p.es_favorito %}Quitar de favoritos{% else %}Agregar a favoritos{% endif %}">
                <i class="bi bi-heart{% if p.es_favorito %}-fill{% endif %}"></i>
              </button>
            </form>
          {% else %}
            <a href="{% url 'usuario:login' %}?next={{ request.path }}" class="btn-favorito" title="Inicia sesión para agregar a favoritos">
              <i class="bi bi-heart"></i>
            </a>
          {% endif %}
        </div>

        <div class="zona-img position-relative text-center">
          {% if p.imagen %}
            <img src="{{ p.imagen.url }}" class="img-fluid" alt="{{ p.nombre }}"
                 style="height:200px;object-fit:contain;">
          {% else %}
            <div class="d-flex align-items-center justify-content-center bg-light" style="height:200px;">
              <span class="text-muted small">Sin imagen</span>
            </div>
          {% endif %}
          <div class="hover-hint">Dar clic para comprar</div>
        </div>

        <div class="mini-card-info text-center">
          <div class="nombre">{{ p.nombre }}</div>
          <div class="precio">${{ p.precio|floatformat:0|intcomma }}</div>
        </div>

        <!-- Hace clickeable toda la card -->
        <a href="{% url 'producto:detalle' p.pk %}" class="stretched-link" aria-label="{{ p.nombre }}"></a>
      </div>
    </div>
  {% empty %}
    <div class="col-12">
      <div class="alert alert-secondary">No hay productos disponibles por ahora.</div>
    </div>
  {% endfor %}
</div>
