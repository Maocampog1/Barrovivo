{% extends "base.html" %}
{% load humanize %}

{% block content %}
<div class="container py-4">
  <div class="row">
    <div class="col-12">
      <h1 class="mb-4">Mis Favoritos</h1>
      
      {% if productos %}
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
          {% for p in productos %}
            <div class="col">
              <div class="card card-producto h-100 position-relative">
                <!-- Botón de favoritos -->
                <div class="favorito-btn position-absolute" style="top: 10px; right: 10px; z-index: 10;">
                  <form method="post" action="{% url 'producto:toggle_favorito' p.id %}" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <button type="submit" class="btn-favorito favorito-activo" title="Quitar de favoritos">
                      <i class="bi bi-heart-fill"></i>
                    </button>
                  </form>
                </div>

                <div class="zona-img position-relative text-center">
                  {% if p.imagen %}
                    <img src="{{ p.imagen.url }}" class="img-fluid" alt="{{ p.nombre }}"
                         style="height:200px;object-fit:contain;">
                  {% else %}
                    <div class="d-flex align-items-center justify-content-center bg-light" style="height:200px;">
                      <span class="text-muted small">Sin imagen</span>
                    </div>
                  {% endif %}
                  <div class="hover-hint">Dar clic para comprar</div>
                </div>

                <div class="mini-card-info text-center">
                  <div class="nombre">{{ p.nombre }}</div>
                  <div class="precio">${{ p.precio|floatformat:0|intcomma }}</div>
                </div>

                <!-- Hace clickeable toda la card -->
                <a href="{% url 'producto:detalle' p.pk %}" class="stretched-link" aria-label="{{ p.nombre }}"></a>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="text-center py-5">
          <i class="bi bi-heart" style="font-size: 4rem; color: #ccc;"></i>
          <h3 class="mt-3">No tienes favoritos</h3>
          <p class="text-muted">Agrega algunos productos a tus favoritos para verlos aquí.</p>
          <a href="{% url 'producto:inicio' %}" class="btn btn-bv">
            Ver productos
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
